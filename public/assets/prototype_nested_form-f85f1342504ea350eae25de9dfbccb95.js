document.observe("click",function(e,t){if(t=e.findElement("form a.add_nested_fields")){var n=t.readAttribute("data-association"),a=t.readAttribute("data-target"),o=$(t.readAttribute("data-blueprint-id")),r=o.readAttribute("data-blueprint"),l=(t.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(l){var s=l.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],c=l.match(/[0-9]+/g)||[];for(i=0;i<s.length;i++)c[i]&&(r=r.replace(new RegExp("(_"+s[i]+")_.+?_","g"),"$1_"+c[i]+"_"),r=r.replace(new RegExp("(\\["+s[i]+"\\])\\[.+?\\]","g"),"$1["+c[i]+"]"))}var d=new RegExp("new_"+n,"g"),u=(new Date).getTime();r=r.replace(d,u);var m;return m=a?$$(a)[0].insert(r):t.insert({before:r}),m.fire("nested:fieldAdded",{field:m}),m.fire("nested:fieldAdded:"+n,{field:m}),!1}}),document.observe("click",function(e,t){if(t=e.findElement("form a.remove_nested_fields")){var n=t.previous(0),a=t.readAttribute("data-association");n&&(n.value="1");var i=t.up(".fields").hide();return i.fire("nested:fieldRemoved",{field:i}),i.fire("nested:fieldRemoved:"+a,{field:i}),!1}});