!function(e){window.NestedFormEvents=function(){this.addFields=e.proxy(this.addFields,this),this.removeFields=e.proxy(this.removeFields,this)},NestedFormEvents.prototype={addFields:function(t){var n=t.currentTarget,a=e(n).data("association"),i=e("#"+e(n).data("blueprint-id")),o=i.data("blueprint"),r=(e(n).closest(".fields").closestChild("input, textarea, select").eq(0).attr("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(r)for(var l=r.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],s=r.match(/[0-9]+/g)||[],c=0;c<l.length;c++)s[c]&&(o=o.replace(new RegExp("(_"+l[c]+")_.+?_","g"),"$1_"+s[c]+"_"),o=o.replace(new RegExp("(\\["+l[c]+"\\])\\[.+?\\]","g"),"$1["+s[c]+"]"));var d=new RegExp("new_"+a,"g"),u=this.newId();o=e.trim(o.replace(d,u));var m=this.insertFields(o,a,n);return m.trigger({type:"nested:fieldAdded",field:m}).trigger({type:"nested:fieldAdded:"+a,field:m}),!1},newId:function(){return(new Date).getTime()},insertFields:function(t,n,a){var i=e(a).data("target");return i?e(t).appendTo(e(i)):e(t).insertBefore(a)},removeFields:function(t){var n=e(t.currentTarget),a=n.data("association"),i=n.prev("input[type=hidden]");i.val("1");var o=n.closest(".fields");return o.hide(),o.trigger({type:"nested:fieldRemoved",field:o}).trigger({type:"nested:fieldRemoved:"+a,field:o}),!1}},window.nestedFormEvents=new NestedFormEvents,e(document).delegate("form a.add_nested_fields","click",nestedFormEvents.addFields).delegate("form a.remove_nested_fields","click",nestedFormEvents.removeFields)}(jQuery),/*
 * Copyright 2011, Tobias Lindig
 *
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 */
function(e){e.fn.closestChild=function(t){if(t&&""!=t){var n=[];for(n.push(this);n.length>0;)for(var a=n.shift(),i=a.children(),o=0;o<i.length;++o){var r=e(i[o]);if(r.is(t))return r;n.push(r)}}return e()}}(jQuery);